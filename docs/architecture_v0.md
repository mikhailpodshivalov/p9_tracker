# Architecture v0 (Этап 1)

Источник: `docs/phase1_plan.md`.

## Компоненты

- `UI`: редакторы song/chain/phrase/instrument/table/mix, пользовательский ввод, отображение состояния.
- `Engine`: доменная логика трекера, обработка команд редактирования, валидация данных.
- `Scheduler`: музыкальный таймбейс (`ticks/PPQ`), порядок исполнения событий, подготовка событий для аудио.
- `Audio`: realtime рендер, микс, master chain, вывод.
- `MIDI`: вход/выход MIDI, clock/transport, трансляция событий в scheduler.
- `Storage`: загрузка/сохранение проекта, версии формата, рендер в файл.
- `DSP/FX`: инструменты, send/master эффекты, обработка сигнала.

## Потоки данных

1. `UI -> Engine`: команды пользователя (редактирование/навигация).
2. `Engine -> Scheduler`: изменения структуры песни и событий воспроизведения.
3. `Scheduler -> Audio`: подготовленные события на аудио-блок.
4. `MIDI -> Scheduler/Engine`: ноты/clock/transport и команды управления.
5. `Audio -> UI`: metering и snapshots состояния (только чтение для UI).
6. `Engine <-> Storage`: сериализация/десериализация проекта и метаданных.

## Потокобезопасность и RT-ограничения

- RT-аудио поток: `no malloc`, `no locks`, `no file IO`, `no blocking logging`.
- Межпоточная передача: lock-free очереди и snapshot-модель состояния.
- UI не изменяет DSP/Audio состояние напрямую; только через команды в Engine/Scheduler.
- Детерминированность: фиксированный порядок обработки событий в пределах тика.

## Примечание

- Документ архитектурный, без реализации и выбора конкретных библиотек.
